{% extends "dashboard_base.html" %}
{% load static %}
{% block title %}All Operatives | JobMate{% endblock %}
{% block content %}

<!-- HEADER -->
<div class="heading-section d-flex flex-column justify-content-between flex-md-row">
  <div class="row">
    <h1 class="section-title">All Operatives</h1>
    <p class="section-subtitle">
      Manage all Operatives across the system
    </p>
  </div>

  <!-- Create Engineer Button Disabled for Now -->
  <!-- <button class="btn btn-primary shadow-cta">
      <i class="bi bi-plus-lg me-2"></i>Create Engineer
    </button> -->
</div>

<!-- FILTERS -->
<div class="filter-container d-flex flex-grow-1 mb-4">

  <!-- Search Bar -->
  <div class="search-col col-12">
    <p class="section-subtitle">Search Operatives</p>
    <form class="input-group" method="GET">
      {% csrf_token %}
      <input type="text" name="search_engineer" class="form-control" placeholder="Search operatives..." />
      <!-- Search Button -->
      <button type="submit" class="btn btn-secondary text-muted">
        <i class="bi bi-search me-1"></i>Search
      </button>
    </form>
  </div>
</div>

<!--MESSAGES TO DISPLAY -->
{% for message in messages %}
{% if message.tags == "error" %}
<div class="alert alert-danger alert-dismissible fade show my-2" role="alert">
  {% else %}
  <div class="alert alert-{{ message.tags }} alert-dismissible fade show my-2" role="alert">
    {% endif %}
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endfor %}

  <!-- ENGINEER LIST -->
  <div>
    <div class="table-container">
      <div class="table-header">All Operatives ({{ engineer_list.count }})</div>
      <div class="table-responsive p-2">
        <table class="table align-middle mb-0">

          <!-- Table Head -->
          <thead class="table-head">
            <tr>
              <th>Operative #</th>
              <th>Role</th>
              <th>Name</th>
              <th>Status</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>

          <!-- Table Body -->
          <tbody>

            <!-- Engineer Row -->
            {% for engineer in engineer_list %}
            <tr>
              <td data-label="Operative ID">
                <P class="text-muted m-0">#OPE-{{ engineer.id }}</P>
              </td>
              <td data-label="Role">{{ engineer.profile.get_role_display }}</td>
              <td data-label="Operative">{{ engineer.first_name }} {{ engineer.last_name }}</td>
              <td data-label="Status">
                <span class="badge badge-rounded 
                {% if engineer.profile.status == 'pending' %}badge-pending
                  {% elif engineer.profile.status == 'in_active' %}badge-progress
                  {% elif engineer.profile.status == 'active' %}badge-completed
                  {% elif engineer.profile.status == 'left' %}bg-danger
                {% endif %} ">
                  {{ engineer.profile.get_status_display }}
                </span>
              </td>
              <td data-label="Created">{{ engineer.profile.created_at }}</td>
              <td data-label="Actions">
                <div class="d-flex flex-row justify-content-around">
                  <a href="{% url 'users:profile_settings' engineer.id %}" class="text-primary me-2"><i class="bi bi-pencil"></i></a>
                  <a href="{% url 'users:delete_operative' engineer.id%}" class="text-danger"><i class="bi bi-trash"></i></a>
                </div>
                <hr class="table-hr">
              </td>
            </tr>
            <!-- If empty rows ie no jobs display message -->
            {% empty %}
            <tr>
              <td colspan="8" class="text-danger">No jobs found!</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  {% endblock %}